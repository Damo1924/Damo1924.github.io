---
title: "CCW & 선분 교차 판별 알고리즘"
toc: true
toc_label: "On this page"
toc_icon: "chevron-right"
categories:    
  - Algorithm
use_math: true
comments: true

---

`Tags`  CCW, Counter Clock Wise, 선분 교차 

## 1. CCW (Counter Clock Wise)

CCW는 2차원 평면에 놓여진 세 점의 방향관계를 구하는 알고리즘이다.

이는 기하 알고리즘에서 자주 사용되는 기초적인 알고리즘들 중 하나이다.

사실 나는 이 알고리즘이 있다는 사실을 [백준 11758. CCW](https://www.acmicpc.net/problem/11758) 문제를 풀고 나서야 알았는데, 그만큼 간단하고 쉬운 알고리즘이다.

알고리즘은 다음과 같다.

2차원 평면 위에 세 점 A, B, C가 주어졌을 때, 점들을 잇는 선분 AB와 선분 BC를 그리자.

선분 AB에 대해 선분 BC가 **반시계 방향**, **직선**, **시계방향** 중 어떤 방향관계를 이루고 있는지 구하는 알고리즘이다.

세 점의 좌표를 각각 $(x_1, y_1)$, $(x_2, y_2)$, $(x_3, y_3)$라고 하면, 다음의 식을 계산함으로써 판별이 가능하다.

> $V$를 $V = (x_2 - x_1)(y_3 - y_2) - (x_3 - x_2)(y_2 - y_1)$ 이라고 정의하자.
> 
> 1) $V > 0$ 이면 반시계 방향  
> 2) $V = 0$ 이면 직선  
> 3) $V < 0$ 이면 시계 방향

### 1-1. CCW 증명하기

먼저, 외적을 알고 있다면 매우 쉽게 증명이 가능하다.

<img src="https://user-images.githubusercontent.com/88201512/145532598-298e7eef-2c6e-402e-bd1b-58227c9f6be5.jpg">

벡터 AB와 벡터 BC를 외적한 결과는 위 그림과 같이 A, B, C의 좌표 또는 두 벡터가 이루는 각도로 표현할 수 있다.

이때 두 벡터가 이루는 각도 $\theta$에 따라 두 선분이 이루는 방향관계를 판별할 수 있다.

- $\theta = 0, \pi$ ($\sin \theta = 0$): 직선
- $0 < \theta < \pi$ ($\sin \theta > 0$): 반시계 방향
- $\pi < \theta < 2 \pi$ ($\sin \theta < 0$): 시계 방향

따라서 $V = (x_2 - x_1)(y_3 - y_2) - (x_3 - x_2)(y_2 - y_1)$가 양수이면 반시계 방향, 음수이면 시계방향, 0이면 직선 관계를 가진다는 것을 알 수 있다.

만약 외적에 대해 알지 못하더라도 직선의 방정식을 통해서도 증명이 가능하다.

<img src="https://user-images.githubusercontent.com/88201512/145532593-ef00acce-454e-448c-af9c-edec8c6ac71f.jpg">

두 점 A, B를 지나는 직선의 방정식에 $x = x_3$를 대입한 결과와 $y_3$를 비교하자.

만약 A의 x좌표 $x_1$이 B의 x좌표 $x_2$보다 작다면 위 그림과 같이 $y_3 > f(x_3)$일 때 반시계 방향 관계를 갖는다.

반대로 $x_1$이 $x_2$보다 크다면 $y_3 < f(x_3)$일 때 반시계 방향 관계를 갖는다.

이때 $y_3 - f(x_3)$를 정리하면 앞서 구한 $V$와 매우 유사한 식을 얻게 된다.

이 식을 $x_1$과 $x_2$의 대소관계에 따라 부등식을 구하면, 앞서 유도한 결과와 동일한 결과를 얻을 수 있다.

또한, $x_1 = x_2$인 경우에도 위 식으로 해결할 수 있다는 것을 확인할 수 있을 것이다.

### 1-2. CCW 구현하기

좌표 값을 입력받아 앞서 구한 식을 계산한 후, 결과값이 양수인지, 음수인지, 아니면 0인지 판별하는 함수를 구현하면 된다.

```cpp
int CCW (int x_1, int y_1, int x_2, int y_2, int x_3, int y_3)
{
    int V = (x_2 - x_1) * (y_3 - y_2) - (x_3 - x_2) * (y_2 - y_1);
    if (V > 0) return 1; // 반시계방향
    else if (V == 0) return 0; // 직선
    else return -1; // 
}
```

<br/>

## 2. 선분 교차 알고리즘

CCW를 이용해서 해결할 수 있는 아주 대표적인 문제인 선분 교차 판별 문제를 풀어보자.

## [백준] 17387. 선분 교차 2

2차원 평면 위에 두 선분의 양 끝점이 주어질 때, 두 선분이 교차하면 1을 출력하고, 교차하지 않으면 0을 출력하는 문제이다.




